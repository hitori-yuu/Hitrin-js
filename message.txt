const { SlashCommandBuilder } = require('@discordjs/builders');
const { MessageEmbed } = require('discord.js');
const disbut = require('discord-buttons');
const { MessageMenuOption, MessageMenu } = require('discord-buttons');
require('dotenv').config();

module.exports = {
	data: new SlashCommandBuilder()
		.setName('test')
		.setDescription('test'),
	async execute(interaction, client) {
		disbut(client);
		const home = new MessageEmbed()
			.setColor('#89c3eb')
			.setTitle('ã‚µãƒ¼ãƒãƒ¼è¨­å®š')
			.setAuthor(`${interaction.user.tag}`, interaction.user.displayAvatarURL({ format: 'png' }), interaction.user.displayAvatarURL({ format: 'png' }))
			.setDescription('ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šã‚’é–‹å§‹ã—ã¾ã™ã€‚ä¸‹ã®ã‚»ãƒ¬ã‚¯ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ä»»æ„ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã€ãã®æŒ‡ç¤ºã«å¾“ã£ã¦ãã ã•ã„ã€‚')
			.setThumbnail(client.user.displayAvatarURL({ format: 'png' }))
			.setFooter('Hitorin', client.user.displayAvatarURL({ format: 'png' }))
			.setTimestamp();

		const global_ban = new MessageEmbed()
			.setColor('#89c3eb')
			.setTitle('ã‚µãƒ¼ãƒãƒ¼è¨­å®š / ã‚°ãƒ­ãƒ¼ãƒãƒ«BAN')
			.setAuthor(`${interaction.user.tag}`, interaction.user.displayAvatarURL({ format: 'png' }), interaction.user.displayAvatarURL({ format: 'png' }))
			.setDescription('**ã€Œã‚°ãƒ­ãƒ¼ãƒãƒ«BANã€ã®è¨­å®š**\nã€Œãƒ’ãƒˆãƒªãƒ³ã€ã§ã¯ã€å±é™ºãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’äº‹å‰ã«ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰BANã‚’ã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚\nã“ã®æ©Ÿèƒ½ã‚’__è¨±å¯ã™ã‚‹å ´åˆ__ã¯xxxã‚’\nã“ã®æ©Ÿèƒ½ã‚’__ç¦æ­¢ã™ã‚‹å ´åˆ__ã¯xxxã‚’')
			.setThumbnail(client.user.displayAvatarURL({ format: 'png' }))
			.setFooter('Hitorin', client.user.displayAvatarURL({ format: 'png' }))
			.setTimestamp();

		const welcome = new MessageEmbed()
			.setColor('#89c3eb')
			.setTitle('ã‚µãƒ¼ãƒãƒ¼è¨­å®š / æ–°è¦ãƒ¡ãƒ³ãƒãƒ¼ãŠçŸ¥ã‚‰ã›')
			.setAuthor(`${interaction.user.tag}`, interaction.user.displayAvatarURL({ format: 'png' }), interaction.user.displayAvatarURL({ format: 'png' }))
			.setDescription('**ã€Œæ–°è¦ãƒ¡ãƒ³ãƒãƒ¼ãŠçŸ¥ã‚‰ã›ã€ã®è¨­å®š**\nã€Œãƒ’ãƒˆãƒªãƒ³ã€ã§ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã«ãƒ¡ãƒ³ãƒãƒ¼ãŒåŠ å…¥ã—ãŸã¨ãã«ãŠçŸ¥ã‚‰ã›ã‚’ã‚’ã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚\nã“ã®æ©Ÿèƒ½ã‚’__è¨±å¯ã™ã‚‹å ´åˆ__ã¯xxxã‚’\nã“ã®æ©Ÿèƒ½ã‚’__ç¦æ­¢ã™ã‚‹å ´åˆ__ã¯xxxã‚’')
			.setThumbnail(client.user.displayAvatarURL({ format: 'png' }))
			.setFooter('Hitorin', client.user.displayAvatarURL({ format: 'png' }))
			.setTimestamp();

		const option1 = new MessageMenuOption()
			.setLabel('ã‚°ãƒ­ãƒ¼ãƒãƒ«BAN')
			.setEmoji('1ï¸âƒ£')
			.setValue('global-ban');

		const option2 = new MessageMenuOption()
			.setLabel('æ–°è¦ãƒ¡ãƒ³ãƒãƒ¼ãŠçŸ¥ã‚‰ã›')
			.setEmoji('2ï¸âƒ£')
			.setValue('welcome');

		const select = new MessageMenu()
			.setID('setting-menu')
			.setPlaceholder('Click')
			.setMaxValues(1)
			.setMinValues(1)
			.addOption(option1, option2);

		const Home = await interaction.reply({ embeds: [home] }, select);

		const filter = (button) => button.clicker.user.id === interaction.user.id;
		const collector = Home.createMenuCollector(filter, { time: 80000 });

		collector.on('collect', (b) => {
			if (b.values[0] == 'global-ban') {
				Home.followUp(global_ban);
			}
			else if (b.values[0] == 'welcome') {
				Home.followUp(welcome);
			}
			b.reply.defer();
		});

		collector.on('end', () => {
			Home.followUp('æœŸé–“åˆ‡ã‚Œ');
		});
	},
};

/*

		const select = new MessageSelectMenu()
			.setCustomId('global_ban_select')
			.setPlaceholder('è¨­å®šã‚’ã™ã‚‹ç¨®é¡')
			.setMaxValues(1)
			.addOptions({
				label: 'ã‚°ãƒ­ãƒ¼ãƒãƒ«BAN',
				value: 'global-ban',
				emoji: 'ğŸ',
			}, {
				label: 'æ–°è¦åŠ å…¥ãŠçŸ¥ã‚‰ã›',
				value: 'welcome',
				emoji: 'ğŸŠ',
			});

*/

/*

				const global_ban_ok = new MessageButton()
					.setCustomId('global_ban_btn_ok')
					.setStyle('SUCCESS')
					.setLabel('ğŸ†—è¨±å¯ã™ã‚‹');
				const global_ban_no = new MessageButton()
					.setCustomId('global_ban_btn_no')
					.setStyle('DANGER')
					.setLabel('â›”ç¦æ­¢ã™ã‚‹');

*/


const { MessageAttachment, MessageEmbed } = require('discord.js');
const img = new MessageAttachment('../materials/bump.png');
function sleep(waitSec, callback) {
	setTimeout(callback, waitSec);
}

module.exports = {
	name: 'interactionCreate',
	async execute(client, interaction) {
		if (interaction.user.id == '302050872383242240') {
			if (interaction.embeds[0].description.match(/è¡¨ç¤ºé †ã‚’ã‚¢ãƒƒãƒ—ã—ãŸã‚ˆ/) || interaction.embeds[0].description.match(/Bump done/)) {
				const embed = new MessageEmbed()
					.setColor('#89c3eb')
					.setTitle('Bumpã‚’æ¤œçŸ¥ï¼')
					.setAuthor(`${interaction.user.tag}`, interaction.user.displayAvatarURL({ format: 'png' }), interaction.user.displayAvatarURL({ format: 'png' }))
					.setDescription(`${new Date() + 2} ã«bumpãŒã§ãã‚‹ã“ã¨ã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ï¼`)
					.setThumbnail(img)
					.setFooter('Hitorin', client.user.displayAvatarURL({ format: 'png' }))
					.setTimestamp();
				interaction.channel.send({ embeds: [embed] });
				sleep(60000 * 120, function() {
					const embed_2 = new MessageEmbed()
						.setColor('#89c3eb')
						.setTitle('Bumpã‚’ã—ã¾ã—ã‚‡ã†ï¼')
						.setDescription('ä»Šãªã‚‰BumpãŒã§ãã¾ã™ï¼ï¼ãƒ¬ãƒƒãƒ„BUMP!')
						.setThumbnail(img)
						.setFooter('Hitorin', client.user.displayAvatarURL({ format: 'png' }))
						.setTimestamp();
					interaction.channel.send({ embeds: [embed_2] });
				});
			}
		}
	},
};